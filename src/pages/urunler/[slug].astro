---
import Layout from "../../layouts/Layout.astro";
import { findProduct } from "../../data/products";

const { slug } = Astro.params;
const product = findProduct(slug!);

function ytId(url: string) {
  if (!url) return "";
  const m = url.match(/(?:v=|\.be\/)([A-Za-z0-9_-]{6,})/);
  return m ? m[1] : url; // ID girildiyse direkt döner
}

if (!product) {
  throw new Error("Ürün bulunamadı");
}
---

<Layout title={product.title} description={product.summary}>
  <section class="bg-black text-white px-4 py-10">
    <div class="max-w-6xl mx-auto">
      <img src={product.cover} alt={product.title} class="w-full h-64 md:h-96 object-cover rounded-lg border border-white/10" loading="lazy" decoding="async" />

      <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 space-y-6">
          <header>
            <h1 class="text-3xl font-bold">{product.title}</h1>
            <p class="mt-2 opacity-80">{product.summary}</p>
          </header>

          {product.youtube && (
            <div class="aspect-video w-full rounded-lg overflow-hidden border border-white/10">
              <iframe
                src={`https://www.youtube.com/embed/${ytId(product.youtube)}`}
                loading="lazy"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
                class="w-full h-full"
                title={`${product.title} videosu`}>
              </iframe>
            </div>
          )}

          {product.gallery?.length > 0 && (
            <div>
              <h2 class="text-xl font-semibold mb-3">Galeri</h2>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                {product.gallery.map((g) => (
                  <img src={g} alt={product.title} loading="lazy" decoding="async" class="w-full h-32 object-cover rounded border border-white/10" />
                ))}
              </div>
            </div>
          )}
        </div>

        <aside class="space-y-6">
          {product.features?.length > 0 && (
            <div class="bg-neutral-900 border border-white/10 rounded-lg p-4">
              <h2 class="text-xl font-semibold mb-3">Teknik Özellikler</h2>
              <ul class="list-disc list-inside space-y-1">
                {product.features.map((f) => (<li>{f}</li>))}
              </ul>
            </div>
          )}

          {product.usage?.length > 0 && (
            <div class="bg-neutral-900 border border-white/10 rounded-lg p-4">
              <h2 class="text-xl font-semibold mb-3">Kullanım Alanları</h2>
              <ul class="list-disc list-inside space-y-1">
                {product.usage.map((u) => (<li>{u}</li>))}
              </ul>
            </div>
          )}

          {product.drawings?.length > 0 && (
            <div class="bg-neutral-900 border border-white/10 rounded-lg p-4">
              <h2 class="text-xl font-semibold mb-3">Teknik Resimler / Dokümanlar</h2>
              <ul class="space-y-2">
                {product.drawings.map((d) => (
                  <li>
                    <a href={d.url} class="underline underline-offset-4 hover:opacity-80" target="_blank" rel="noopener">
                      {d.title}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          )}
        </aside>
      </div>

      <div class="mt-10">
        <a href="/urunler" class="opacity-80 hover:opacity-100 underline underline-offset-4">← Tüm ürünlere dön</a>
      </div>
    </div>
  </section>
</Layout>
