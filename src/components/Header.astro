---
import HeaderLink from "../components/HeaderLink.astro";
---

<header class="relative z-50">
  <nav class="flex items-center justify-between h-16 px-4 md:px-6">
    <!-- Logo -->
    <a href="/" class="text-2xl font-nasa tracking-wide text-white select-none">TARAGAY</a>

    <!-- Masaüstü menü -->
    <div class="hidden md:flex items-center gap-2">
      <HeaderLink href="/">Ana Sayfa</HeaderLink>
      <button id="apply-open" class="px-3 py-2 underline underline-offset-4">Başvurular</button>
      <HeaderLink href="/hakkimizda">Hakkımızda</HeaderLink>
      <HeaderLink href="/ekibimiz">Ekibimiz</HeaderLink>
      <HeaderLink href="/urunler">Ürünler</HeaderLink>
      <HeaderLink href="/galeri">Galeri</HeaderLink>
      <HeaderLink href="/bize-ulasin">Bize Ulaşın</HeaderLink>
    </div>

    <!-- Mobil burger -->
    <button id="menu-toggle"
      class="md:hidden inline-flex items-center justify-center p-2 rounded border border-white/20"
      aria-controls="mobile-drawer" aria-expanded="false" aria-label="Menüyü aç/kapat">
      <span class="block h-[2px] w-6 bg-white mb-1"></span>
      <span class="block h-[2px] w-6 bg-white mb-1"></span>
      <span class="block h-[2px] w-6 bg-white"></span>
    </button>
  </nav>

  <!-- Karanlık arka plan -->
  <div id="backdrop" class="fixed inset-0 z-[55] bg-black/70 opacity-0 invisible transition-opacity duration-200"></div>

  <!-- Sağdan açılan çekmece: genişlik ekranın 1/3'ü -->
  <aside id="mobile-drawer"
    class="fixed top-0 right-0 z-[70] h-[100svh] w-[33vw] max-w-[22rem] min-w-[18rem] translate-x-full transition-transform duration-200
           bg-neutral-950 border-l border-white/10 shadow-2xl">
    <nav class="px-4 py-6">
      <ul class="space-y-2">
        <li><HeaderLink href="/" data-nav-link class="block px-2 py-3 text-lg">Ana Sayfa</HeaderLink></li>
        <li><button id="apply-open-mobile" class="w-full text-left block px-2 py-3 text-lg underline underline-offset-4">Başvurular</button></li>
        <li><HeaderLink href="/hakkimizda" data-nav-link class="block px-2 py-3 text-lg">Hakkımızda</HeaderLink></li>
        <li><HeaderLink href="/ekibimiz" data-nav-link class="block px-2 py-3 text-lg">Ekibimiz</HeaderLink></li>
        <li><HeaderLink href="/urunler" data-nav-link class="block px-2 py-3 text-lg">Ürünler</HeaderLink></li>
        <li><HeaderLink href="/galeri" data-nav-link class="block px-2 py-3 text-lg">Galeri</HeaderLink></li>
        <li><HeaderLink href="/bize-ulasin" data-nav-link class="block px-2 py-3 text-lg">Bize Ulaşın</HeaderLink></li>
      </ul>
    </nav>
  </aside>

  <!-- Başvurular: dokunulabilir pencere (mobilde bottom-sheet) -->
  <div id="apply-overlay"
    class="fixed inset-0 z-[80] bg-black/80 backdrop-blur-sm opacity-0 invisible transition-opacity duration-200"
    role="dialog" aria-modal="true" aria-labelledby="apply-title">
    <div class="absolute inset-x-0 bottom-0 md:inset-auto md:bottom-6 md:right-6 md:max-w-md
                bg-neutral-900 border border-white/10 rounded-t-2xl md:rounded-2xl shadow-xl">
      <div class="p-5">
        <div class="flex items-center justify-between">
          <h2 id="apply-title" class="text-lg font-semibold">Başvurular</h2>
          <button id="apply-close" class="p-2 rounded hover:bg-white/10" aria-label="Kapat">✕</button>
        </div>
        <div class="mt-3 space-y-2">
          <a href="https://forms.gle/dYwdF6eTEquCkMsQ7" target="_blank" rel="noopener noreferrer"
             class="block px-3 py-3 rounded bg-white/10 hover:bg-white/15">Dikey İnişli Roket Yarışması (başvur)</a>
          <a href="/basvurular#ortak-proje" class="block px-3 py-3 rounded bg-white/10 hover:bg-white/15">Ortak Proje Başvurusu</a>
          <a href="/basvurular#iletisim" class="block px-3 py-3 rounded bg-white/10 hover:bg-white/15">İletişim</a>
          <a href="/basvurular" class="block px-3 py-3 text-sm opacity-70 hover:opacity-100">Tüm Başvurular sayfasına git →</a>
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    (() => {
      const $ = (s) => document.querySelector(s);
      const toggleBtn = $('#menu-toggle');
      const drawer = $('#mobile-drawer');
      const backdrop = $('#backdrop');

      const openDrawer = () => {
        drawer.classList.remove('translate-x-full');
        backdrop.classList.remove('opacity-0','invisible');
        document.body.style.overflow='hidden';
        toggleBtn?.setAttribute('aria-expanded','true');
      };
      const closeDrawer = () => {
        drawer.classList.add('translate-x-full');
        backdrop.classList.add('opacity-0','invisible');
        document.body.style.overflow='';
        toggleBtn?.setAttribute('aria-expanded','false');
      };

      toggleBtn?.addEventListener('click', () => {
        (toggleBtn.getAttribute('aria-expanded') === 'true') ? closeDrawer() : openDrawer();
      });
      backdrop?.addEventListener('click', closeDrawer);
      document.addEventListener('keydown', e => { if(e.key === 'Escape'){ closeDrawer(); closeApply(); }});
      document.querySelectorAll('[data-nav-link]').forEach(a => a.addEventListener('click', closeDrawer));

      // Başvurular dialog
      const applyOverlay = $('#apply-overlay');
      const openApply = () => { 
        applyOverlay.classList.remove('opacity-0','invisible'); 
        document.body.style.overflow='hidden'; 
        closeDrawer(); 
      };
      const closeApply = () => { 
        applyOverlay.classList.add('opacity-0','invisible'); 
        document.body.style.overflow=''; 
      };

      $('#apply-open')?.addEventListener('click', openApply);
      $('#apply-open-mobile')?.addEventListener('click', openApply);
      $('#apply-close')?.addEventListener('click', closeApply);
      applyOverlay?.addEventListener('click', (e)=>{ if(e.target === applyOverlay) closeApply(); });
    })();
  </script>
</header>
